psi02 = [1;0];
target2 = [0;1];
ftarget2 = phi2ftarget(target2);
H02 = diag([0, 1]);
Edomain2 = [-1, 2];
mu2 = [0 1; 1 0];
[Hoperations2, fmu2] = Hmats2Hops(H02, mu2);
allT2 = (4:10)*2*pi*5;
NT2 = length(allT2);
Nt_ts2 = 7;
Ncheb2 = 7;
Nt_max2 = 1000;
dt2 = allT2(end)/Nt_max2;
options2 = optionsOCqn(1e-4, 1e4);
fieldws2 = zeros(NT2, Nt_max2 + 1);
fieldts2 = zeros(NT2, Nt_max2*(Nt_ts2 - 1) + 1);
allpsi2 = zeros(3, Nt_max2 + 1, length(allT2));
allconv2 = zeros(NT2, 10001);
allniter2 = zeros(1, NT2);
allJmax2 = zeros(1, NT2);
energies2 = zeros(1, NT2);
allrelE2 = zeros(1, NT2);
for Ti = 1:NT2
    options2.f_max_alpha =  get_f_max_alphaOCf(0.5, dt2, allT2(Ti), 1e3*0.5*(1 - tanh(2*(w-3))));
    Nti = round(Nt_max2*allT2(Ti)/allT2(end));
    %[fieldt3u3I, fieldw3u3I, psi3u3I, relE3u3I, conv3u3I, niter3u3I, mallniterc3u3I, Jterms3u3I, maxgrad3u3I, alpha3u3I, invHess3u3I] = OClimf_qn(u0_3, ftarget3u3I, Hoperations3u1ceI, 2, fcouplingOp3u1ce, [-0.2 0.2], fieldw3u3, @(w)5*0.5*(1-tanh(20*(w-0.25))), options3u3I, 400, 0.25, 7, 7, 1e-6);
    [fieldts2(Ti, 1:(Nti + 1)), fieldws2(Ti, 1:(Nti + 1)), allpsi2(:, 1:(Nti + 1), Ti), allrelE2(Ti), convi, allniter2(Ti), ~, Jtermsi] = OClimf_qn(psi02, ftarget2, Hoperations2, 1, fmu2, Edomain2, @(w) 0.01*0.5*(1 - tanh(2*(w-3))), 1e3*0.5*(1 - tanh(2*(w-3))), options2, allT2(Ti), dt2, Nt_ts2, Ncheb2, 1e-6);
    allconv2(Ti, 1:(allniter2(Ti) + 1)) = convi;
    allJmax2(Ti) = Jtermsi.Jmax;
    energies2(Ti) = Jtermsi.Jenergy;
end