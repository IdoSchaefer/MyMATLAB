function [performance, gradient] = percosV0b_grad(Vk, xdomain, kdomain, Nk, szpenal, pospenal, t)
% The function computes the performance parameter for a cosine series
% absorbing potential, with 0 boundary conditions in both edges.
    sz = size(Vk);
    if sz(1) == 1
        Nfree_k = sz(2)/2;
        Vk = Vk.';
    else
        Nfree_k = sz(1)/2;
    end
    % The cosine term coefficients, multiplied by sqrt(Nk/2), for the real
    % and imaginary parts:
    Vk_re_fix0 = Vk(1:Nfree_k);
    Vk_re_fix0(1) = Vk_re_fix0(1)/2;
    Vk_im_fix0 = Vk((Nfree_k + 1):2*Nfree_k);
    Vk_im_fix0(1) = Vk_im_fix0(1)/2;
    % The Nk and Nk-1 terms, subject to the boundary constraints:
    VkNre = -2*sum(Vk_re_fix0(Nfree_k:-2:1));
    VkNminus1re = -sum(Vk_re_fix0((Nfree_k - 1):-2:1));
    VkNim = -2*sum(Vk_im_fix0(Nfree_k:-2:1));
    VkNminus1im = -sum(Vk_im_fix0((Nfree_k - 1):-2:1));
    Vxreal = dctI([Vk(1:(Nfree_k)); VkNminus1re; VkNre]);
    Vximag = dctI([Vk((Nfree_k + 1):2*Nfree_k); VkNminus1im; VkNim]);
%    Vx = dctI([Vk(1:(Nfree_k)); VkNminus1re; VkNre]) + 1i*dctI([Vk((Nfree_k + 1):2*Nfree_k); VkNminus1im; VkNim]);
    [parameter, gradVx] = Vabs_efficiency1(Vxreal + 1i*Vximag, xdomain, kdomain, Nk);
    performance = parameter + szpenal*sum(Vk.^2) + pospenal*sum(exp(Vximag*t));
    gradient = zeros(2*Nfree_k);
end